# Chapter 1: Wallflower

You have entered a dungeon. A gnome standing on an adjacent tile nods in greeting, then hands you a small parcel, and finally leaves the dungeon by walking onto the staircase where you entered. Unwrapping the parcel, you find an anachronistic timepiece. The timepiece counts ticks, the standard unit of dungeon time. The tick count starts at zero in each dungeon, and increments whenever you are about to walk onto another tile.

On closer inspection of the unfolded wrapping, you identify it as a magic map. The map shows a symbolic representation of any dungeon that you enter. You study the map:

```
##############################[#######[###]###################]#####]#########
############################.#..]##]...]....[#######]########]...[##..[#######
##########################[.....#[...[...#.]#######]...[#####..]..]#...]######
#########################[#..#.]....]].#[[..######[..[.####][.##[..].]..]#####
##############[########[#....[...#[]##[####.]####...[#..]#]...]##[...][.######
#############[.####[###...]..#.#]#..]#####[...####.]##[.##[#.#####[##[....]###
##[###########.####.....]#......]#...]###....[###]..###......]########.[#]####
#...[#########.####.#[#.###].]..#].[.....[.#[######.]##....]######[###..]##]##
#]...]######][.##[[...######.[[.#..[[#]#.[..<[###[[..##]##.####]##..[#].#[..##
#..[....[##]...[[.[.].####[.......[]##.].##[......]...[###.###[.#[.......]...]
#.#[[##...[#[...]..#..[####[..[.#[[.#].#...[##][#.#[.]###].###]...#.##[[]#[..#
[...]#[]#.....[....[.]######[##.#...[..[]#..][.......]####]####.]......[.....#
##]....[#....[#[#..]..########....[.#....]].....].#####[#####]..#]..#[.#.##.]#
#[...]###]#######[..].#########]##....[..##[#####.##]...[###[..]##.]...[.#[..#
#..[.###[#########[...]##########[...]#.[######]#.#[..[..####.]#.#.[[.##.##..#
#.[####[.##]#######[#.[###########.[]]....[####...]#.]##.]#[..]]....[.]...]#.#
[..##[...[..########]..#############[..[..####[.###..##[...#.]....[#]...[]...]
#..###[.....]########..[#####]####]...]##]###...]#]..#....[...]#]..]###][..[##
##.###[#.#]....###]##]###]....###]...]########..#[..[#]..##[]..]#[..]#]#..[###
##.##[.#.##].##]...#[###[..#].###][]..]#######.#[..][...###[#[...[[..]...]####
##.[#]...#[..[##.]...##[..][..[]...[[...[#####.[..]##...[#[.[....##[...].#####
#]..[..#]#..[#[......[[..]...][...###[..#####]...]###].]#.].....]###[###]#####
##[...[##[...[..].###[..]#[.....[.]....[######[..####[..#.#[...###############
#####]######.]....#]...]####.##][...[...[#######[####]..].....[###############
###########[...[[....#]############]##[###############]...###]################
##############]#####]####################################]####################
```

You are standing at the bottom of the staircase where you entered (marked `<` on the map), facing east (right on the map). You can walk on the floor tiles (marked `.`). You always walk forward if you can, without turning. Walking to the next tile takes one tick of dungeon time.

Whenever you are about to walk into a wall (marked `[`, `#`, or `]`), you instead stay where you are and turn. You turn 90 degrees left in front of `[` walls, 180 degrees around in front of `#` walls, and 90 degrees right in front of `]` walls. Staying and turning also takes one tick. Never mind if you still face a wall after turning. You deal with that later.

The timepiece starts counting ticks immediately, including any time you spend turning before leaving the staircase. You leave the dungeon by returning to the staircase. After how many ticks do you leave the dungeon?


## Example

Consider a smaller dungeon:

```
#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##]......]#
###]########]##
```

Below is a log of exploring the smaller dungeon. Your position at each tick is marked `@`.

```
Tick counter: 0
Position: 38 (8, 2)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.....[
#.......@.[[..#
]...##]......]#
###]########]##

---

Tick counter: 1
Position: 39 (9, 2)
Direction: East
Next symbol: [

#######]#[#####
#]].....#.....[
#.......<@[[..#
]...##]......]#
###]########]##

---

Tick counter: 2
Position: 39 (9, 2)
Direction: North
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<@[[..#
]...##]......]#
###]########]##

---

Tick counter: 3
Position: 24 (9, 1)
Direction: North
Next symbol: [

#######]#[#####
#]].....#@....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 4
Position: 24 (9, 1)
Direction: West
Next symbol: #

#######]#[#####
#]].....#@....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 5
Position: 24 (9, 1)
Direction: East
Next symbol: .

#######]#[#####
#]].....#@....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 6
Position: 25 (10, 1)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.@...[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 7
Position: 26 (11, 1)
Direction: East
Next symbol: .

#######]#[#####
#]].....#..@..[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 8
Position: 27 (12, 1)
Direction: East
Next symbol: .

#######]#[#####
#]].....#...@.[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 9
Position: 28 (13, 1)
Direction: East
Next symbol: [

#######]#[#####
#]].....#....@[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 10
Position: 28 (13, 1)
Direction: North
Next symbol: #

#######]#[#####
#]].....#....@[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 11
Position: 28 (13, 1)
Direction: South
Next symbol: .

#######]#[#####
#]].....#....@[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 12
Position: 43 (13, 2)
Direction: South
Next symbol: ]

#######]#[#####
#]].....#.....[
#.......<.[[.@#
]...##]......]#
###]########]##

---

Tick counter: 13
Position: 43 (13, 2)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[.@#
]...##]......]#
###]########]##

---

Tick counter: 14
Position: 42 (12, 2)
Direction: West
Next symbol: [

#######]#[#####
#]].....#.....[
#.......<.[[@.#
]...##]......]#
###]########]##

---

Tick counter: 15
Position: 42 (12, 2)
Direction: South
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[@.#
]...##]......]#
###]########]##

---

Tick counter: 16
Position: 57 (12, 3)
Direction: South
Next symbol: ]

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##].....@]#
###]########]##

---

Tick counter: 17
Position: 57 (12, 3)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##].....@]#
###]########]##

---

Tick counter: 18
Position: 56 (11, 3)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##]....@.]#
###]########]##

---

Tick counter: 19
Position: 55 (10, 3)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##]...@..]#
###]########]##

---

Tick counter: 20
Position: 54 (9, 3)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##]..@...]#
###]########]##

---

Tick counter: 21
Position: 53 (8, 3)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##].@....]#
###]########]##

---

Tick counter: 22
Position: 52 (7, 3)
Direction: West
Next symbol: ]

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##]@.....]#
###]########]##

---

Tick counter: 23
Position: 52 (7, 3)
Direction: North
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]...##]@.....]#
###]########]##

---

Tick counter: 24
Position: 37 (7, 2)
Direction: North
Next symbol: .

#######]#[#####
#]].....#.....[
#......@<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 25
Position: 22 (7, 1)
Direction: North
Next symbol: ]

#######]#[#####
#]]....@#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 26
Position: 22 (7, 1)
Direction: East
Next symbol: #

#######]#[#####
#]]....@#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 27
Position: 22 (7, 1)
Direction: West
Next symbol: .

#######]#[#####
#]]....@#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 28
Position: 21 (6, 1)
Direction: West
Next symbol: .

#######]#[#####
#]]...@.#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 29
Position: 20 (5, 1)
Direction: West
Next symbol: .

#######]#[#####
#]]..@..#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 30
Position: 19 (4, 1)
Direction: West
Next symbol: .

#######]#[#####
#]].@...#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 31
Position: 18 (3, 1)
Direction: West
Next symbol: ]

#######]#[#####
#]]@....#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 32
Position: 18 (3, 1)
Direction: North
Next symbol: #

#######]#[#####
#]]@....#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 33
Position: 18 (3, 1)
Direction: South
Next symbol: .

#######]#[#####
#]]@....#.....[
#.......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 34
Position: 33 (3, 2)
Direction: South
Next symbol: .

#######]#[#####
#]].....#.....[
#..@....<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 35
Position: 48 (3, 3)
Direction: South
Next symbol: ]

#######]#[#####
#]].....#.....[
#.......<.[[..#
]..@##]......]#
###]########]##

---

Tick counter: 36
Position: 48 (3, 3)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]..@##]......]#
###]########]##

---

Tick counter: 37
Position: 47 (2, 3)
Direction: West
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
].@.##]......]#
###]########]##

---

Tick counter: 38
Position: 46 (1, 3)
Direction: West
Next symbol: ]

#######]#[#####
#]].....#.....[
#.......<.[[..#
]@..##]......]#
###]########]##

---

Tick counter: 39
Position: 46 (1, 3)
Direction: North
Next symbol: .

#######]#[#####
#]].....#.....[
#.......<.[[..#
]@..##]......]#
###]########]##

---

Tick counter: 40
Position: 31 (1, 2)
Direction: North
Next symbol: ]

#######]#[#####
#]].....#.....[
#@......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 41
Position: 31 (1, 2)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.....[
#@......<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 42
Position: 32 (2, 2)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.....[
#.@.....<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 43
Position: 33 (3, 2)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.....[
#..@....<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 44
Position: 34 (4, 2)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.....[
#...@...<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 45
Position: 35 (5, 2)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.....[
#....@..<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 46
Position: 36 (6, 2)
Direction: East
Next symbol: .

#######]#[#####
#]].....#.....[
#.....@.<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 47
Position: 37 (7, 2)
Direction: East
Next symbol: <

#######]#[#####
#]].....#.....[
#......@<.[[..#
]...##]......]#
###]########]##

---

Tick counter: 48
Direction: East
```

You leave the smaller dungeon after 48 ticks.
